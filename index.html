<!DOCTYPE html>
<html>
<head>
    <title>The JoeApp</title>
    <style>
        body { font-family: sans-serif; max-width: 400px; margin: 40px auto; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        input, textarea, button { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #f7a01a; color: white; cursor: pointer; }
    </style>
</head>
<body>
    <h1>JoeApp: Mood Log</h1>
    <form id="moodForm">
        <label for="mood_score">How are you feeling!? Mood (1-10):</label>
        <input type="number" id="mood_score" min="1" max="10" required>
        
        <label for="notes">Notes:</label>
        <textarea id="notes"></textarea>
        
        <label for="tags">Tags:</label>
        <input type="text" id="tags">
        
        <button type="submit">Log It!</button>
    </form>
    <p id="feedback"></p>

    <script type="module">
        // 1. IMPORT ONLY THE NECESSARY FUNCTIONS (V9 Firebase SDK)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp,query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

   
        // 2. YOUR FIREBASE CONFIGURATION
        const firebaseConfig = {
            // Replace with your actual values (I've kept your provided data here)
            apiKey: "AIzaSyDeoZvj5eRsvWxyuow-j72byoo52197c5Y",
            authDomain: "joeapp-v1.firebaseapp.com",
            projectId: "joeapp-v1",
            storageBucket: "joeapp-v1.firebasestorage.app",
            messagingSenderId: "973294244660",
            appId: "1:973294244660:web:1a8c2302428992bf02cb61",
            measurementId: "G-5QE4C2DCJX"
        };
        
        // 3. INITIALIZE SERVICES
        const app = initializeApp(firebaseConfig); 
        const db = getFirestore(app); 
        
        // 4. GET DOM ELEMENTS
        const form = document.getElementById('moodForm');
        const feedback = document.getElementById('feedback');

        // 5. EVENT LISTENER FOR FORM SUBMISSION
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            feedback.textContent = "Logging data...";

            try {
                // Use the modern API structure: addDoc(collection(db, "collectionName"), dataObject)
                await addDoc(collection(db, "moods"), { 
                    mood_score: parseInt(form.mood_score.value),
                    notes: form.notes.value,
                    tags: form.tags.value,
                    timestamp: serverTimestamp() 
                });

                feedback.textContent = `Mood logged successfully!`;
                form.reset();
                await fetchMoods();
            } catch (e) {
                feedback.textContent = "Error logging mood: " + e.message;
            }
        });
        
        // Function to fetch and display the last 5 mood entries
        async function fetchMoods() {
            const list = document.getElementById('moodsList');
            list.innerHTML = '<li>Loading recent moods...</li>';
            
            try {
                // Construct a query: target 'moods', order by 'timestamp' (newest first), limit to 5
                const q = query(
                    collection(db, "moods"), 
                    orderBy('timestamp', 'desc'), 
                    limit(5)
                );
                
                const moodsSnapshot = await getDocs(q); // Execute the query
        
                list.innerHTML = ''; // Clear loading message
        
                if (moodsSnapshot.empty) {
                    list.innerHTML = '<li>No moods logged yet. Go on, log one!</li>';
                    return;
                }
        
                moodsSnapshot.forEach(doc => {
                    const data = doc.data();
                    // Convert Firestore Timestamp to a readable date string
                    const time = data.timestamp ? data.timestamp.toDate().toLocaleDateString() + ' ' + data.timestamp.toDate().toLocaleTimeString() : 'No Time';
                    
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <strong>Mood: ${data.mood_score} / 10</strong>
                        <br>
                        <em>${data.notes}</em>
                        <span style="font-size: 0.8em; color: #888;"> (${data.tags || 'No Tags'}) - ${time}</span>
                    `;
                    list.appendChild(listItem);
                });
        
            } catch (e) {
                list.innerHTML = `<li>Error fetching data: ${e.message}</li>`;
                console.error("Error fetching documents: ", e);
            }
        }
        
        // Call the display function when the page loads
        window.onload = fetchMoods;



    </script>
<hr>
    <h2>Recent Moods</h2>
    <ul id="moodsList">
        </ul>
</body>
</html>
